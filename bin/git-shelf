#!/usr/bin/env ruby
$LOAD_PATH.unshift File.expand_path("../../lib", __FILE__)

require "thor"
require 'yaml'

require 'git_shelf'

class MyCLI < Thor
  desc "get CATEGORY URL", "Get a repository from URL and put it into CATEGORY directory."

  def get(category, url)
    puts "get from #{url} and put it into #{category}"
  end

  desc "dump ROOT OUT_YAML_PATH", "Dump repositories directory tree each category to OUT_YAML_PATH."

  def dump(root, out)
    repositories = GitShelf::Repositories.from_root_path(root)
    data = {
        repositories: repositories.to_a
    }
    YAML.dump(data, File.open(out, 'w'))
  end

  desc "count CATEGORY", "Count CATEGORY of repositories from cached yml."
  option :cache_file, type: :string, required: true

  def count(category)
    cache_file = options[:cache_file]
    cache = YAML.load_file(cache_file)

    repositories = GitShelf::Repositories.from_array(cache[:repositories])
    puts repositories.count(category).to_table
  end
end

MyCLI.start(ARGV)
